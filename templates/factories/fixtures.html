{% include "base.html" %}
{% include "factories/nav-bar.html" %}

<style>
    .data-schema {
        width: 980px;
        margin: auto;
    }

    .data-schema-title, .add-new-schema {
        display: inline-block;
    }

    .add-new-schema {
        float: right;
    }

    .row-link {
        height: 21px;
    }

    #edit {
        color: #0275D8;
        margin-right: 10px;
    }

    #delete {
        color: #D9534F;
    }
</style>
<div class="data-schema">
    <h2 class="data-schema-title">Data schemas</h2>
    <a type="button" class="btn btn-success add-new-schema" href="{% url "fixture-add" %}">New schema</a>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Title</th>
            <th scope="col">Modified</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for row in records %}
            <tr>
                <th scope="row" class="row-id">{{ row.id }}</th>
                <td>{{ row.name }}</td>
                <td>{{ row.modified|date:"Y-m-d" }}</td>
                <td>
                    <a class="row-link" id="edit" href="#">Edit schema</a>
                    <a class="row-link" id="delete" href="#" name="{{ row.id }}">Delete</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    $('#delete').click(function (e) {
        const DELETE_URL = "{% url "fixture-list" %}";
        const csrftoken = getCookie('csrftoken');

        $.ajax({
            url: DELETE_URL + this.name,
            headers: {"X-CSRFToken": csrftoken},
            type: 'DELETE',
            success: function (result) {
                location.reload();
            }
        });
    })
</script>